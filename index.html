<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Shiori Naito Happy Birthday！</title>
  
  <!-- ファビコン -->
  <link rel="icon" type="image/png" href="favicon.png" />

  <style>
    /* --- ローディング画面 --- */
    #loading {
      position: fixed;
      top: 0; left: 0;
      width: 100vw; height: 100vh;
      background: #fff;
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 9999;
      opacity: 1;
      transition: opacity 1s ease;
      pointer-events: all;
    }
    #loading.fadeout {
      opacity: 0;
      pointer-events: none;
    }
    #loading video {
      width: 300px;
      height: auto;
    }

    /* 背景設定 */
    body {
      margin: 0;
      font-family: 'Arial', sans-serif;
      background: linear-gradient(135deg, #ff9a9e 0%, #fad0c4 99%, #fad0c4 100%);
      position: relative;
      overflow-x: hidden;
      min-height: 100vh;
    }

    /* ぼんやり風船の丸と影 */
    body::before {
      content: "";
      position: fixed;
      top: 10%;
      left: 5%;
      width: 200px;
      height: 300px;
      background: radial-gradient(circle at center, rgba(255, 182, 193, 0.3), transparent 70%);
      border-radius: 50% 50% 50% 50% / 60% 60% 40% 40%;
      box-shadow:
        100px 150px 0 0 rgba(255, 182, 193, 0.3),
        150px 80px 0 0 rgba(255, 192, 203, 0.25),
        300px 200px 0 0 rgba(255, 192, 203, 0.2);
      pointer-events: none;
      z-index: 0;
    }

    /* 紙吹雪のようなキラキラ */
    body::after {
      content: "";
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background-image:
        radial-gradient(circle, #fff9 1px, transparent 1px),
        radial-gradient(circle, #ffdd 2px, transparent 2px),
        radial-gradient(circle, #ffd 1.5px, transparent 1.5px);
      background-repeat: repeat;
      background-size: 50px 50px, 100px 100px, 75px 75px;
      pointer-events: none;
      z-index: 0;
    }

    /* ヘッダー・画像と紙吹雪用キャンバス */
    header {
      position: relative;
      width: 100%;
      height: 100vh;
      background-color: transparent;
      display: flex;
      justify-content: center;
      align-items: center;
      overflow: hidden;
      z-index: 1;
    }

    header img {
      max-width: 80%;
      height: auto;
      z-index: 1;
    }

    canvas.confetti {
      position: absolute;
      top: 0;
      left: 0;
      z-index: 2;
      pointer-events: none;
    }

    canvas.shootingStars {
      position: fixed;
      top: 0; left: 0;
      width: 100vw;
      height: 100vh;
      pointer-events: none;
      z-index: 5;
    }

    /* ボタンセクション */
    .button-section {
      position: fixed;
      bottom: 40px; /* 下げた */
      right: 20px;
      display: flex;
      align-items: center;
      gap: 15px;
      z-index: 10;
    }

    /* ボタン共通 */
    button.audio-toggle {
      background-color: #ff69b4;
      border: none;
      border-radius: 50%;
      width: 60px;
      height: 60px;
      cursor: pointer;
      box-shadow: 0 4px 10px rgba(0,0,0,0.2);
      display: flex;
      justify-content: center;
      align-items: center;
      overflow: visible;
      transition: background-color 0.3s ease;
    }
    button.audio-toggle:hover {
      background-color: #ff4c9e;
    }

    button.audio-toggle svg {
      width: 30px;
      height: 30px;
      fill: white;
      overflow: visible;
      transition: transform 0.3s ease;
    }

    /* 画像大量表示用 */
    #imgContainer {
      position: fixed;
      top: 0; left: 0;
      width: 100vw;
      height: 100vh;
      pointer-events: none;
      overflow: hidden;
      z-index: 9;
      display: none;
    }

    #imgContainer img {
      position: absolute;
      width: 80px;
      height: 80px;
      object-fit: contain;
      user-select: none;
      pointer-events: none;
      animation: weirdMove 5s forwards, fadeOut 1.5s 4s forwards;
    }

    @keyframes weirdMove {
      0% {
        transform: translateY(100vh) scale(1) rotate(0deg);
        opacity: 1;
      }
      25% {
        transform: translateY(70vh) scale(1.1) rotate(10deg);
      }
      50% {
        transform: translateY(40vh) scale(0.9) rotate(-15deg);
      }
      75% {
        transform: translateY(10vh) scale(1.15) rotate(7deg);
      }
      100% {
        transform: translateY(-100px) scale(1) rotate(0deg);
      }
    }

    @keyframes fadeOut {
      to {
        opacity: 0;
      }
    }
  </style>
</head>
<body>
  <!-- ローディング画面 -->
  <div id="loading" aria-label="読み込み中">
    <video src="loading.mp4" autoplay muted playsinline></video>
  </div>

  <header>
    <img src="ShioriNaitoHappy%20Birthday!.png" alt="Shiori Naito Happy Birthday!">
    <canvas class="confetti"></canvas>
    <canvas class="shootingStars"></canvas>
  </header>

  <audio id="bgm" src="happybgm.mp3" loop autoplay muted></audio>

  <div id="imgContainer"></div>

  <div class="button-section" aria-label="BGMの再生/停止">
    <button class="audio-toggle" id="toggleAudio" aria-label="BGMの再生/停止">
      <svg viewBox="0 0 24 24" id="audioIcon">
        <path id="iconPath" d="M8 5v14l11-7z"></path> <!-- ▶ 再生 -->
      </svg>
    </button>
  </div>

  <script>
    // --- ローディング処理 ---
    const loading = document.getElementById('loading');
    const loadingVideo = loading.querySelector('video');

    loadingVideo.addEventListener('ended', () => {
      loading.classList.add('fadeout');
      setTimeout(() => {
        loading.style.display = 'none';
      }, 1000);
    });

    // --- 紙吹雪 ---
    const confettiCanvas = document.querySelector('.confetti');
    const confettiCtx = confettiCanvas.getContext('2d');
    let confettis = [];

    function resizeCanvas() {
      confettiCanvas.width = window.innerWidth;
      confettiCanvas.height = window.innerHeight;
      shootingCanvas.width = window.innerWidth;
      shootingCanvas.height = window.innerHeight;
    }

    window.addEventListener('resize', resizeCanvas);
    resizeCanvas();

    class Confetti {
      constructor() {
        this.reset();
      }
      reset() {
        this.x = Math.random() * confettiCanvas.width;
        this.y = Math.random() * -confettiCanvas.height;
        this.w = Math.random() * 12 + 4;
        this.h = Math.random() * 6 + 4;
        this.opacity = Math.random() * 0.8 + 0.2;
        this.angle = Math.random() * 360;
        this.rotateSpeed = (Math.random() - 0.5) * 5;
        this.speed = Math.random() * 4 + 2;
        this.gravity = Math.random() * 0.6 + 0.5;
        this.color = this.randomColor();
        this.shape = Math.random() > 0.5 ? 'rect' : 'circle';
      }
      randomColor() {
        const colors = [
          '#ff0a54', '#ff477e', '#ff7096', '#ff85a1',
          '#fbb1bd', '#ffd700', '#00e0ff', '#00ff94',
          '#ff8c00', '#adff2f', '#8a2be2'
        ];
        return colors[Math.floor(Math.random() * colors.length)];
      }
      update() {
        this.y += this.speed + this.gravity;
        this.x += Math.sin(this.angle * Math.PI / 180) * 1.5;
        this.angle += this.rotateSpeed;
        if (this.y > confettiCanvas.height) {
          this.reset();
          this.y = 0;
        }
      }
      draw(ctx) {
        ctx.save();
        ctx.translate(this.x, this.y);
        ctx.rotate(this.angle * Math.PI / 180);
        ctx.globalAlpha = this.opacity;
        ctx.fillStyle = this.color;
        if (this.shape === 'rect') {
          ctx.fillRect(-this.w / 2, -this.h / 2, this.w, this.h);
        } else {
          ctx.beginPath();
          ctx.arc(0, 0, this.w / 2, 0, 2 * Math.PI);
          ctx.fill();
        }
        ctx.restore();
      }
    }

    for (let i = 0; i < 500; i++) {
      confettis.push(new Confetti());
    }

    function animateConfetti() {
      confettiCtx.clearRect(0, 0, confettiCanvas.width, confettiCanvas.height);
      confettis.forEach(c => {
        c.update();
        c.draw(confettiCtx);
      });
      requestAnimationFrame(animateConfetti);
    }

    animateConfetti();

    // --- 流れ星 (右下→左上、左上→右下) ---
    const shootingCanvas = document.querySelector('.shootingStars');
    const shootingCtx = shootingCanvas.getContext('2d');

    class ShootingStar {
      constructor() {
        this.reset();
      }
      reset() {
        this.length = Math.random() * 80 + 50;
        this.speed = Math.random() * 7 + 10;
        this.opacity = 0;
        this.fadeInSpeed = 0.03;
        this.fadeOutSpeed = 0.01;
        this.active = false;
        this.startTime = performance.now() + Math.random() * 5000; // ランダム開始遅延
        this.direction = Math.random() > 0.5 ? 1 : -1; // 1:右下→左上, -1:左上→右下

        if (this.direction === 1) {
          // 右下→左上
          this.x = shootingCanvas.width + this.length;
          this.y = shootingCanvas.height + this.length;
          this.vx = -this.speed;
          this.vy = -this.speed;
        } else {
          // 左上→右下
          this.x = -this.length;
          this.y = -this.length;
          this.vx = this.speed;
          this.vy = this.speed;
        }
      }
      update(time) {
        if (time < this.startTime) return;

        if (!this.active) {
          this.active = true;
          this.opacity = 0;
        }

        this.x += this.vx;
        this.y += this.vy;

        if (this.opacity < 1 && this.active) {
          this.opacity += this.fadeInSpeed;
          if (this.opacity > 1) this.opacity = 1;
        }

        // フェードアウト開始判定（キャンバス外に出たら）
        if (
          this.x < -this.length || this.x > shootingCanvas.width + this.length ||
          this.y < -this.length || this.y > shootingCanvas.height + this.length
        ) {
          this.opacity -= this.fadeOutSpeed;
          if (this.opacity <= 0) {
            this.reset();
            this.active = false;
          }
        }
      }
      draw(ctx) {
        if (!this.active) return;
        ctx.save();
        ctx.globalAlpha = this.opacity;
        // 金色グラデーション
        let grad = ctx.createLinearGradient(this.x, this.y, this.x - this.vx * this.length, this.y - this.vy * this.length);
        grad.addColorStop(0, 'rgba(255, 215, 0, 1)');   // gold
        grad.addColorStop(1, 'rgba(255, 215, 0, 0)');   // transparent
        ctx.strokeStyle = grad;
        ctx.lineWidth = 2;
        ctx.beginPath();
        ctx.moveTo(this.x, this.y);
        ctx.lineTo(this.x - this.vx * this.length, this.y - this.vy * this.length);
        ctx.stroke();

        // 星の輝き
        ctx.fillStyle = 'rgba(255, 215, 0, ' + this.opacity + ')';
        ctx.beginPath();
        ctx.arc(this.x, this.y, 3, 0, 2 * Math.PI);
        ctx.fill();
        ctx.restore();
      }
    }

    const shootingStars = [];
    for(let i = 0; i < 6; i++) {
      shootingStars.push(new ShootingStar());
    }

    function animateShootingStars(time=0) {
      shootingCtx.clearRect(0, 0, shootingCanvas.width, shootingCanvas.height);
      shootingStars.forEach(star => {
        star.update(time);
        star.draw(shootingCtx);
      });
      requestAnimationFrame(animateShootingStars);
    }
    animateShootingStars();

    // --- BGM自動再生＆ボタン制御 ---
    const audio = document.getElementById('bgm');
    const toggleBtn = document.getElementById('toggleAudio');
    const iconPath = document.getElementById('iconPath');

    const playPath = "M8 5v14l11-7z"; // ▶
    const pausePath = "M6 5h4v14H6zm8 0h4v14h-4z"; // ||

    function updateIcon() {
      if (audio.paused) {
        iconPath.setAttribute('d', playPath);
      } else {
        iconPath.setAttribute('d', pausePath);
      }
    }

    toggleBtn.addEventListener('click', () => {
      if (audio.paused) {
        audio.muted = false; // ミュート解除して音あり再生
        audio.play();
      } else {
        audio.pause();
      }
      updateIcon();
    });

    // ページロード時はミュート自動再生
    audio.muted = true;
    audio.play().catch(() => {
      // 自動再生がブロックされた場合の処理はここに
    });
    updateIcon();

    // --- imgshiori大量表示（省略したければ削除可能） ---
    const imgToggleBtn = null; // 削除済みボタンのため不要
    const imgContainer = document.getElementById('imgContainer');
    let animationRunning = false;

    function randomPosition() {
      return {
        x: Math.random() * (window.innerWidth - 80),
        y: window.innerHeight + 100
      };
    }

    function createImage() {
      const img = document.createElement('img');
      img.src = 'imgshiori.png';
      const pos = randomPosition();
      img.style.left = pos.x + 'px';
      img.style.top = pos.y + 'px';
      imgContainer.appendChild(img);
      img.addEventListener('animationend', () => {
        img.remove();
      });
    }

    function startImageRain() {
      if (animationRunning) return;
      animationRunning = true;
      imgContainer.style.display = 'block';
      let count = 0;
      const maxCount = 100;
      const interval = setInterval(() => {
        createImage();
        count++;
        if (count >= maxCount) {
          clearInterval(interval);
          setTimeout(() => {
            imgContainer.style.display = 'none';
            animationRunning = false;
          }, 6000);
        }
      }, 50);
    }

    // imgToggleBtnがないので画像大量表示は使っていません
  </script>
</body>
</html>
